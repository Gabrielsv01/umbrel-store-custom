services:
  openclaw:
    image: alpine/openclaw:latest
    container_name: openclaw_gateway_1
    restart: unless-stopped
    user: root
    ports:
      - 5143:80
    volumes:
      - ${APP_DATA_DIR}/data:/root/.openclaw
    environment:
      - TZ=America/Sao_Paulo
      - NODE_ENV=production
  proxy:
    image: nginx:alpine
    container_name: openclaw_proxy
    restart: unless-stopped
    network_mode: service:openclaw
    command: >
      /bin/sh -c "echo 'events {} http { 
        server { 
          listen 80; 
          location / { 
            proxy_pass http://127.0.0.1:18789; 
            proxy_http_version 1.1; 
            proxy_set_header Upgrade $$http_upgrade; 
            proxy_set_header Connection \"upgrade\"; 
            
            # Repassando as informações REAIS da sua rede:
            proxy_set_header Host $$http_host;
            proxy_set_header X-Forwarded-For $$remote_addr;
            proxy_set_header X-Real-IP $$remote_addr;
          } 
        } 
      }' > /etc/nginx/nginx.conf && nginx -g 'daemon off;'"
    depends_on:
      - openclaw